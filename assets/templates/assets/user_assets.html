{% extends 'base.html' %}
{% load static %}

{% block title %}{{ profile_user.full_name }}'s Assets - Knowledge Engine{% endblock %}

{% block content %}
<div class="asset-dashboard">
    
    <!-- Page Header -->
    <div class="dashboard-header">
        <h1 class="dashboard-title">{{ profile_user.full_name }}'s Assets</h1>
        <p class="dashboard-subtitle">Assets assigned to {{ profile_user.designation }} in {{ profile_user.department }}</p>
    </div>

    <!-- User Information -->
    <div class="sidebar-card" style="margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; gap: 1.5rem;">
            {% if profile_user.photo %}
                <img src="{{ profile_user.photo.url }}" alt="{{ profile_user.full_name }}'s photo" style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid #eaddd7;">
            {% else %}
                <div style="width: 80px; height: 80px; border-radius: 50%; background-color: #eaddd7; display: flex; align-items: center; justify-content: center; font-family: 'Lato', sans-serif; font-weight: 900; font-size: 1.5rem; color: #3a3a3a;">
                    {{ profile_user.first_name.0|upper }}
                </div>
            {% endif %}
            <div style="flex: 1;">
                <h3 style="margin: 0 0 0.25rem 0; font-family: 'Lato', sans-serif; font-weight: 900; color: #1f2937;">{{ profile_user.full_name }}</h3>
                <p style="margin: 0 0 0.25rem 0; color: #6b7280;">{{ profile_user.designation }} - {{ profile_user.department }}</p>
                <p style="margin: 0; font-size: 0.9rem; color: #6b7280;">{{ profile_user.email }}</p>
            </div>
            <div style="text-align: right;">
                {% if profile_user.on_duty %}
                    <div class="duty-status on-duty">On Duty</div>
                {% else %}
                    <div class="duty-status off-duty">Off Duty</div>
                {% endif %}
                <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: #6b7280;">Shift: {{ profile_user.shift }}</p>
            </div>
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="stats-grid" style="margin-bottom: 2rem;">
        <div class="stat-card">
            <h3>Total Assets</h3>
            <p class="stat-number total">{{ assets|length }}</p>
        </div>
        <div class="stat-card">
            <h3>Active Assets</h3>
            <p class="stat-number active">{{ assets|length }}</p>
        </div>
        <div class="stat-card">
            <h3>Maintenance Due</h3>
            <p class="stat-number maintenance">{{ maintenance_due|length }}</p>
        </div>
        <div class="stat-card">
            <h3>Asset Types</h3>
            <p class="stat-number total">{{ assets.values_list.asset_type__name.distinct|length }}</p>
        </div>
    </div>

    <!-- Quick Actions -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <div style="display: flex; gap: 1rem;">
            <a href="{% url 'profile' %}" class="btn btn-secondary">Back to Profile</a>
            <a href="{% url 'asset_list' %}" class="btn btn-secondary">All Assets</a>
        </div>
        <div style="font-family: 'Lora', serif; color: #6b7280;">
            {{ assets|length }} asset{{ assets|length|pluralize }} assigned
        </div>
    </div>

    <!-- Maintenance Due Alert -->
    {% if maintenance_due %}
        <div style="padding: 1rem; background-color: #fef3c7; border-radius: 0.375rem; border-left: 4px solid #f59e0b; margin-bottom: 2rem;">
            <h4 style="margin: 0 0 0.5rem 0; color: #92400e; font-family: 'Lato', sans-serif; font-weight: 700;">⚠️ Maintenance Due</h4>
            <p style="margin: 0; color: #92400e;">{{ maintenance_due|length }} asset{{ maintenance_due|length|pluralize }} require{{ maintenance_due|length|pluralize:"s," }} immediate maintenance attention.</p>
        </div>
    {% endif %}

    <!-- Asset Grid -->
    {% if assets %}
        <div class="asset-grid">
            {% for asset in assets %}
                <div class="asset-card">
                    <div class="asset-card-header">
                        <h3 class="asset-tag">{{ asset.asset_tag }}</h3>
                        <p class="asset-name">{{ asset.name }}</p>
                    </div>
                    
                    <div class="asset-card-body">
                        <div class="asset-meta">
                            <div class="asset-meta-item">
                                <div class="asset-meta-label">Type</div>
                                <p class="asset-meta-value">{{ asset.asset_type.name }}</p>
                            </div>
                            <div class="asset-meta-item">
                                <div class="asset-meta-label">Manufacturer</div>
                                <p class="asset-meta-value">{{ asset.manufacturer.name }}</p>
                            </div>
                            <div class="asset-meta-item">
                                <div class="asset-meta-label">Location</div>
                                <p class="asset-meta-value">{{ asset.location.name }}</p>
                            </div>
                            <div class="asset-meta-item">
                                <div class="asset-meta-label">Last Maintenance</div>
                                <p class="asset-meta-value">
                                    {% if asset.last_maintenance %}
                                        {{ asset.last_maintenance }}
                                    {% else %}
                                        <span style="color: #6b7280; font-style: italic;">Not recorded</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                        
                        {% if asset.description %}
                            <p style="font-family: 'Lora', serif; font-size: 0.9rem; color: #6b7280; margin: 1rem 0 0 0; line-height: 1.4;">
                                {{ asset.description|truncatewords:15 }}
                            </p>
                        {% endif %}
                    </div>
                    
                    <div class="asset-card-footer">
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <span class="status-badge {{ asset.status }}">{{ asset.get_status_display }}</span>
                            <span class="priority-badge {{ asset.priority }}">{{ asset.get_priority_display }}</span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            {% if asset.is_maintenance_due %}
                                <span class="maintenance-indicator due">
                                    <span class="maintenance-dot"></span>
                                    Due
                                </span>
                            {% elif asset.next_maintenance %}
                                <span class="maintenance-indicator scheduled">
                                    <span class="maintenance-dot"></span>
                                    {{ asset.next_maintenance }}
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Card Actions -->
                    <div style="padding: 1rem 1.5rem; background-color: #ffffff; border-top: 1px solid #eaddd7;">
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{% url 'asset_detail' asset.asset_tag %}" class="btn btn-small btn-primary">View Details</a>
                            {% if asset.is_maintenance_due %}
                                <a href="{% url 'maintenance_schedule' %}?asset={{ asset.id }}" class="btn btn-small" style="background-color: #f59e0b; color: white;">Schedule Maintenance</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="sidebar-card" style="text-align: center; padding: 3rem;">
            <h3 style="font-family: 'Lato', sans-serif; font-weight: 900; color: #6b7280; margin-bottom: 1rem;">No Assets Assigned</h3>
            <p style="font-family: 'Lora', serif; color: #6b7280; margin-bottom: 2rem;">
                {{ profile_user.full_name }} currently has no assets assigned.
            </p>
            <div style="display: flex; gap: 1rem; justify-content: center;">
                <a href="{% url 'asset_list' %}" class="btn btn-primary">Browse Assets</a>
                <a href="{% url 'profile' %}" class="btn btn-secondary">Back to Profile</a>
            </div>
        </div>
    {% endif %}

</div>
{% endblock %}