{% extends 'base.html' %}
{% load static %}

{% block title %}{{ user.full_name }}'s Profile - Knowledge Engine{% endblock %}

{% block content %}

<!-- Compact Profile Grid Layout -->
<div class="profile-grid-container">
    
    <!-- Row 1: Profile Overview -->
    <div class="profile-overview-section">
        <!-- Profile Photo -->
        <div class="profile-photo-compact">
            {% if user.photo %}
                <img src="{{ user.photo.url }}" alt="{{ user.full_name }}'s photo" class="profile-photo-img">
            {% else %}
                <div class="profile-photo-placeholder-compact">
                    <span class="photo-initials-compact">{{ user.first_name.0|upper }}{{ user.last_name.0|upper }}</span>
                </div>
            {% endif %}
        </div>
        
        <!-- Professional Info -->
        <div class="professional-info-compact">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Staff ID</span>
                    <span class="info-value">{{ user.id_number }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email</span>
                    <span class="info-value">{{ user.email }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Username</span>
                    <span class="info-value">{{ user.username }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Location</span>
                    <span class="info-value">{% if user.location %}{{ user.location }}{% else %}Not Assigned{% endif %}</span>
                </div>
            </div>
        </div>
        
        <!-- Session Info -->
        <div class="session-info-compact">
            <div class="session-grid">
                {% if user.login_time %}
                    <div class="session-item">
                        <span class="session-label">Last Login</span>
                        <span class="session-value">{{ user.login_time|date:"M d, H:i" }}</span>
                    </div>
                {% endif %}
                {% if user.logout_time %}
                    <div class="session-item">
                        <span class="session-label">Last Logout</span>
                        <span class="session-value">{{ user.logout_time|date:"M d, H:i" }}</span>
                    </div>
                {% endif %}
                <div class="session-item">
                    <span class="session-label">Account Status</span>
                    <span class="session-value">
                        {% if user.is_active %}
                            <span class="status-active">Active</span>
                        {% else %}
                            <span class="status-inactive">Inactive</span>
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 2: Main Content Grid -->
    <div class="profile-main-grid">
        
        <!-- Certifications Column -->
        <div class="certifications-section">
            <h3 class="section-title">üèÜ Professional Certifications</h3>
            {% if user.certifications.all %}
                <div class="certifications-compact">
                    {% for cert in user.certifications.all %}
                        <div class="cert-item">
                            <span class="cert-name">{{ cert.name }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state-compact">
                    <p>No certifications on record</p>
                </div>
            {% endif %}
        </div>

        <!-- Assets Column -->
        <div class="assets-section">
            <h3 class="section-title">‚öôÔ∏è Asset Responsibilities 
                {% if user.assigned_assets.all %}
                    <span class="count-badge">{{ user.assigned_assets.all|length }}</span>
                {% endif %}
            </h3>
            {% if user.assigned_assets.all %}
                <div class="assets-compact">
                    {% for asset in user.assigned_assets.all|slice:":6" %}
                        <div class="asset-item">
                            <div class="asset-status-dot status-{{ asset.status }}"></div>
                            <div class="asset-content">
                                <a href="{% url 'asset_detail' asset.asset_tag %}" class="asset-link">{{ asset.asset_tag }}</a>
                                <span class="asset-name">{{ asset.name }}</span>
                                <div class="asset-meta-compact">
                                    <span>{{ asset.asset_type.name }}</span>
                                    {% if asset.is_maintenance_due %}
                                        <span class="maintenance-due">‚ö†Ô∏è Due</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    {% if user.assigned_assets.all|length > 6 %}
                        <div class="view-more">
                            <a href="{% url 'user_assets' user.id %}" class="view-more-link">View all {{ user.assigned_assets.all|length }} assets ‚Üí</a>
                        </div>
                    {% endif %}
                </div>
            {% else %}
                <div class="empty-state-compact">
                    <p>No assets assigned</p>
                </div>
            {% endif %}
        </div>

        <!-- Activity Column -->
        <div class="activity-section">
            <h3 class="section-title">üìä Recent Activity</h3>
            {% if recent_asset_logs %}
                <div class="activity-compact">
                    {% for log in recent_asset_logs|slice:":5" %}
                        <div class="activity-item">
                            <div class="activity-dot activity-{{ log.event_type }}"></div>
                            <div class="activity-content">
                                <div class="activity-header">
                                    <a href="{% url 'asset_detail' log.asset.asset_tag %}" class="activity-asset">{{ log.asset.asset_tag }}</a>
                                    <span class="activity-time">{{ log.timestamp|date:"M d" }}</span>
                                </div>
                                <p class="activity-description">{{ log.description|truncatewords:8 }}</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state-compact">
                    <p>No recent activity</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Quick Actions Row -->
    <div class="profile-actions">
        <a href="{% url 'user_assets' user.id %}" class="action-btn primary">View My Assets</a>
        <a href="{% url 'asset_list' %}" class="action-btn secondary">Browse All Assets</a>
        <a href="{% url 'asset_dashboard' %}" class="action-btn secondary">Asset Dashboard</a>
    </div>
    
</div>
{% endblock %}
